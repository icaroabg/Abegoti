<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jogo da MemÃ³ria - Elementos QuÃ­micos</title>
  <link rel="shortcut icon" href="./images/brain.png" type="image/x-icon" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Press Start 2P', cursive;
    }

    body {
      background: url('./images/bg.jpeg') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #05186d;
      padding-bottom: 40px;
    }

    .start-screen {
      background: rgba(255, 255, 255, 0.95);
      padding: 40px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      margin-top: 50px;
      animation: fadeIn 1s ease-in-out;
    }

    .start-screen h1 {
      font-size: 1.3em;
      margin-bottom: 20px;
    }

    .start-screen input {
      padding: 12px;
      font-size: 14px;
      border-radius: 8px;
      border: 2px solid #05186d;
      width: 80%;
      margin: 15px 0;
      outline: none;
    }

    .start-screen button {
      padding: 12px 30px;
      font-size: 14px;
      background-color: #05186d;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    .start-screen button:hover {
      background-color: #0d2fa3;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    main {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
      padding: 20px;
    }

    header {
      background: rgba(255, 255, 255, 0.8);
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      display: flex;
      justify-content: space-around;
      width: 90%;
      max-width: 800px;
      font-size: 0.8em;
    }

    .game-panel {
      margin-bottom: 20px;
    }

    .game-panel button {
      padding: 10px 20px;
      font-size: 12px;
      background: #05186d;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 15px;
      width: 90%;
      max-width: 800px;
    }

    .card {
      aspect-ratio: 3 / 4;
      border-radius: 10px;
      position: relative;
      transform-style: preserve-3d;
      transition: 0.5s;
      cursor: pointer;
    }

    .face {
      position: absolute;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      border: 3px solid #05186d;
      border-radius: 10px;
      backface-visibility: hidden;
    }

    .front {
      transform: rotateY(180deg);
    }

    .back {
      background-image: url('./images/back.png');
    }

    .reveal-card {
      transform: rotateY(180deg);
    }

    .disabled-card {
      filter: grayscale(1);
      opacity: 0.4;
    }

    .card.shuffle-effect {
      animation: shuffle-spin 0.6s ease-in-out;
    }

    @keyframes shuffle-spin {
      0% { transform: rotateY(0deg); }
      50% { transform: rotateY(180deg); }
      100% { transform: rotateY(0deg); }
    }

    .ranking {
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 15px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
    }

    .ranking h2 {
      font-size: 1em;
      margin-bottom: 15px;
      color: #05186d;
    }

    .ranking ul {
      list-style: none;
      padding: 0;
    }

    .ranking li {
      margin-bottom: 10px;
      padding: 10px;
      background-color: #e6f0ff;
      border-radius: 8px;
      font-size: 0.8em;
      display: flex;
      justify-content: space-between;
    }

    .ranking li:nth-child(1)::before {
      content: "ðŸ¥‡ ";
    }

    .ranking li:nth-child(2)::before {
      content: "ðŸ¥ˆ ";
    }

    .ranking li:nth-child(3)::before {
      content: "ðŸ¥‰ ";
    }
  </style>
</head>
<body>
  <div class="start-screen">
    <h1>Jogo da MemÃ³ria</h1>
    <h2>Digite seu nome:</h2>
    <input type="text" class="input-name" placeholder="Seu nome" />
    <button class="start-button">Jogar</button>
  </div>

  <main>
    <header>
      <span class="player">Jogador</span>
      <span>Tempo: <span class="timer">0</span>s</span>
      <span>Tentativas: <span class="attempts">0</span></span>
    </header>

    <div class="game-panel">
      <button id="music-toggle-btn">Ligar MÃºsica</button>
      <audio id="background-music" loop>
        <source src="./sounds/bg.mp3" type="audio/mpeg" />
      </audio>
    </div>

    <section class="grid"></section>
  </main>

  <section class="ranking">
    <h2>Ranking Local</h2>
    <ul id="ranking-list"></ul>
  </section>

  <script>
    const startScreen = document.querySelector('.start-screen');
    const startButton = document.querySelector('.start-button');
    const inputName = document.querySelector('.input-name');
    const main = document.querySelector('main');
    const spanPlayer = document.querySelector('.player');
    const timer = document.querySelector('.timer');
    const attempts = document.querySelector('.attempts');
    const grid = document.querySelector('.grid');
    const rankingList = document.getElementById('ranking-list');

    const soundStart = new Audio('./sounds/start.mp3');
    const soundFlip = new Audio('./sounds/flip.mp3');
    const soundMatch = new Audio('./sounds/match.mp3');
    const soundMismatch = new Audio('./sounds/mismatch.mp3');
    const soundWin = new Audio('./sounds/win.mp3');

    const musicToggleButton = document.getElementById('music-toggle-btn');
    const backgroundMusic = document.getElementById('background-music');
    let isMusicOn = false;

    const pairs = [
      { id: 'ouro', pair: ['ouro', 'ouro2'] },
      { id: 'ferro', pair: ['ferro', 'ferro2'] },
      { id: 'cesio', pair: ['cesio', 'cesio2'] },
      { id: 'litio', pair: ['litio', 'litio2'] },
      { id: 'hidrogenio', pair: ['hidrogenio', 'hidrogenio2'] },
      { id: 'sodio', pair: ['sodio', 'sodio2'] },
      { id: 'uranio', pair: ['uranio', 'uranio2'] },
      { id: 'aluminio', pair: ['aluminio', 'aluminio2'] },
      { id: 'galio', pair: ['galio', 'galio2'] },
      { id: 'boro', pair: ['boro', 'boro2'] }
    ];

    const charactersList = pairs.flatMap(p => p.pair);
    const getBaseId = (name) => name.replace(/[0-9]/g, '');

    let firstCard = '';
    let secondCard = '';
    let loop;
    let attemptCount = 0;
    let playerName = '';
    let playerTime = 0;

    const createElement = (tag, className) => {
      const element = document.createElement(tag);
      element.className = className;
      return element;
    };

    const checkEndGame = () => {
      const disabledCards = document.querySelectorAll('.disabled-card');
      if (disabledCards.length === charactersList.length) {
        clearInterval(loop);
        soundWin.play();
        setTimeout(() => {
          const again = confirm(`ParabÃ©ns, ${spanPlayer.innerHTML}! Seu tempo foi de ${timer.innerHTML} segundos e vocÃª fez ${attemptCount} tentativas.\nDeseja jogar novamente?`);
          if (again) location.reload();
        }, 500);
        saveToRanking();
      }
    };

    const checkCards = () => {
      const firstCharacter = getBaseId(firstCard.getAttribute('data-character'));
      const secondCharacter = getBaseId(secondCard.getAttribute('data-character'));

      if (firstCharacter === secondCharacter) {
        soundMatch.play();
        firstCard.firstChild.classList.add('disabled-card');
        secondCard.firstChild.classList.add('disabled-card');
        firstCard = '';
        secondCard = '';
        checkEndGame();
      } else {
        soundMismatch.play();
        setTimeout(() => {
          firstCard.classList.remove('reveal-card');
          secondCard.classList.remove('reveal-card');
          firstCard = '';
          secondCard = '';
        }, 600);
      }
    };

    const revealCard = ({ target }) => {
      if (target.parentNode.classList.contains('reveal-card') || secondCard) return;
      target.parentNode.classList.add('reveal-card');
      soundFlip.play();

      if (!firstCard) {
        firstCard = target.parentNode;
      } else {
        secondCard = target.parentNode;
        checkCards();
      }

      attemptCount++;
      attempts.innerHTML = attemptCount;
    };

    const createCard = (character) => {
      const card = createElement('div', 'card');
      const front = createElement('div', 'face front');
      const back = createElement('div', 'face back');

      front.style.backgroundImage = `url('./images/${character}.png')`;

      card.appendChild(front);
      card.appendChild(back);

      card.setAttribute('data-character', character);
      card.addEventListener('click', revealCard);

      return card;
    };

    const loadGame = () => {
      const shuffled = charactersList.sort(() => Math.random() - 0.5);
      grid.innerHTML = '';

      shuffled.forEach(character => {
        const card = createCard(character);
        grid.appendChild(card);
      });

      const allCards = document.querySelectorAll('.card');
      allCards.forEach(card => card.classList.add('reveal-card'));

      setTimeout(() => {
        allCards.forEach(card => card.classList.remove('reveal-card'));

        setTimeout(() => {
          allCards.forEach((card, index) => {
            setTimeout(() => {
              card.classList.add('shuffle-effect');
              setTimeout(() => card.classList.remove('shuffle-effect'), 600);
            }, index * 20);
          });
        }, 300);

      }, 1450);
    };

    const startTimer = () => {
      let time = 0;
      loop = setInterval(() => {
        timer.innerHTML = ++time;
        playerTime = time;
      }, 1000);
    };

    const loadRanking = () => {
      const ranking = JSON.parse(localStorage.getItem('ranking')) || [];
      const sorted = ranking.sort((a, b) => a.time - b.time);
      rankingList.innerHTML = sorted.map((player, index) => {
        const highlight = player.name === playerName ? 'style="background:#d6ffd6;"' : '';
        return `<li ${highlight}>${index + 1}. ${player.name} - ${player.time}s</li>`;
      }).join('');
    };

    const saveToRanking = () => {
      const ranking = JSON.parse(localStorage.getItem('ranking')) || [];
      ranking.push({ name: playerName, time: playerTime });
      localStorage.setItem('ranking', JSON.stringify(ranking));
      loadRanking();
    };

    startButton.addEventListener('click', () => {
      playerName = inputName.value.trim();
      if (!playerName) return alert("Digite seu nome!");
      spanPlayer.innerHTML = playerName;
      startScreen.style.display = 'none';
      main.style.display = 'flex';
      soundStart.play();
      startTimer();
      loadGame();
    });

    musicToggleButton.addEventListener('click', () => {
      if (isMusicOn) {
        backgroundMusic.pause();
        musicToggleButton.textContent = 'Ligar MÃºsica';
      } else {
        backgroundMusic.play();
        musicToggleButton.textContent = 'Desligar MÃºsica';
      }
      isMusicOn = !isMusicOn;
    });

    window.addEventListener('load', loadRanking);
  </script>
</body>
</html>
